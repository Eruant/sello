/*! sello 10/06/2013 */
function socketServer(){"use strict";var a={offices:[{name:"brighton",label:"Brighton",users:[]},{name:"london",label:"London",users:[]},{name:"new-york",label:"New York",users:[]},{name:"san-francisco",label:"San Francisco",users:[]}]};console.log("<<< starting socket server >>>"),io.configure(function(){io.set("transports",["xhr-polling"]),io.set("polling duration",10)}),io.sockets.on("connection",function(b){console.log("<<< connection made >>>"),console.log("Host "+b.handshake.headers.host),b.emit("msg",{offices:a.offices}),b.on("user",function(b){if(void 0!==b.user){var c,d,e=a.offices,f=e.length;for(c=0;f>c;c+=1)e[c].name===b.office&&(d=e[c].users.indexOf(b.user),-1!==d?(console.log("Removing a user",b.user),a.offices[c].users.splice(d,1)):(console.log("Adding a user",b.user),a.offices[c].users.push(b.user)));io.sockets.emit("msg",{offices:a.offices})}})})}var port=process.env.PORT||5e3,url=require("url"),path=require("path"),fs=require("fs"),app=require("http").createServer(function(a,b){"use strict";console.log("<<< starting static server >>>");var c="bin/"+url.parse(a.url).pathname,d=path.join(process.cwd(),c);path.exists(d,function(a){return a?(fs.statSync(d).isDirectory()&&(d+="index.html"),fs.readFile(d,"binary",function(a,c){return a?(b.writeHead(500,{"Content-Type":"text/plain"}),b.write(a+"\n"),b.end(),void 0):(b.writeHead(200),b.write(c,"binary"),b.end(),void 0)}),void 0):(b.writeHead(404,{"Content-Type":"text/plain"}),b.write("404 Not Found\n"),b.end(),void 0)})}),io=require("socket.io").listen(app);app.listen(port),console.log("<<< listening on port:"+port+" >>>"),socketServer();
/*! sello 06/06/2013 */
function getExtension(a){var b=a.lastIndexOf(".");return 0>b?"":a.substr(b)}function staticServer(a,b){"use strict";console.log("<<< starting static server >>>");var c="bin/"+url.parse(a.url).pathname,d=path.join(process.cwd(),c);path.exists(d,function(a){return a?(fs.statSync(d).isDirectory()&&(d+="index.html"),fs.readFile(d,"binary",function(a,c){if(a)return b.writeHead(500,{"Content-Type":"text/plain"}),b.write(a+"\n"),b.end(),void 0;var e=getExtension(d);switch(e){case"txt":b.writeHead(200,{"Content-Type":"text/plain"});break;case"html":case"htm":b.writeHead(200,{"Content-Type":"text/html"});break;case"js":b.writeHead(200,{"Content-Type":"text/javascript"});break;case"css":b.writeHead(200,{"Content-Type":"text/css"})}b.write(c,"binary"),b.end()}),void 0):(b.writeHead(404,{"Content-Type":"text/plain"}),b.write("404 Not Found\n"),b.end(),void 0)})}function socketServer(){"use strict";console.log("<<< starting socket server >>>"),io.configure(function(){io.set("transports",["xhr-polling"]),io.set("polling duration",10)}),io.sockets.on("connection",function(a){console.log("<<< connection made >>>"),a.emit("news",{hello:"world"}),a.on("msg",function(a){console.log(a)})})}var app=require("http").createServer(staticServer),url=require("url"),path=require("path"),fs=require("fs"),port=process.env.PORT||5e3,io=require("socket.io").listen(app);app.listen(port),console.log("<<< listening on port:"+port+" >>>"),socketServer();